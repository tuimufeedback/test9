<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>PRE-Client — Parallel Redirect Engine (Client)</title>
<style>
  :root{font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial}
  body{margin:0;min-height:100vh;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,#0f172a,#0b1220);color:#fff}
  .card{width:94%;max-width:520px;padding:24px;border-radius:12px;background:linear-gradient(180deg,rgba(255,255,255,0.04),rgba(255,255,255,0.02));box-shadow:0 8px 30px rgba(2,6,23,0.6);text-align:center}
  h1{margin:0 0 6px;font-size:18px}
  p{margin:6px 0 16px;color:#cbd5e1;font-size:14px}
  .btn{display:inline-block;padding:12px 18px;border-radius:10px;background:#ff7a59;color:#111;font-weight:700;text-decoration:none;box-shadow:0 6px 18px rgba(255,122,89,0.18)}
  .small{font-size:13px;color:#94a3b8;margin-top:10px}
  a.inline{color:#7ee3bd}
</style>
</head>
<body>
  <div class="card">
    <h1>PRE-Client — Parallel Redirect Engine</h1>
    <p>Trang này tự động mở ứng dụng Shopee trên Android (intent) hoặc chuyển về link iOS. Nếu không tự mở, bấm nút bên dưới.</p>
    <a id="manual" class="btn" href="#" onclick="manualOpen();return false;">Mở thủ công</a>
    <div class="small">Nếu bạn dùng GitHub Pages, đặt file này làm index.html và gắn link GitHub lên Beacons.</div>
  </div>

<script>
const shopeeCode = "805SQETqCU";
const iosUrl = `https://s.shopee.vn/${shopeeCode}`;
const androidIntent = `intent://s.shopee.vn/${shopeeCode}#Intent;scheme=https;package=com.shopee.vn;end`;
const chromeNavigate = `googlechrome://navigate?url=${encodeURIComponent(iosUrl)}`;
const chromeIntent = `intent://s.shopee.vn/${shopeeCode}#Intent;package=com.android.chrome;scheme=https;S.browser_fallback_url=${encodeURIComponent(iosUrl)};end`;

const FIRST_DELAY = 10;
const RETRY_SHORT = 120;
const RETRY_LONG = 700;
const FINAL_FALLBACK = 1400;

const ua = navigator.userAgent || "";
const isIOS = /iphone|ipad|ipod/i.test(ua);
const isAndroid = /android/i.test(ua);

function safeOpen(url) {
  try { window.location.href = url; } catch(e){}
}

function manualOpen(){
  if (isIOS) safeOpen(iosUrl);
  else safeOpen(androidIntent);
}

function runPreClient() {
  if (isIOS) {
    setTimeout(()=>{ window.location.replace(iosUrl); }, FIRST_DELAY+10);
    return;
  }

  try {
    const iframe = document.createElement('iframe');
    iframe.style.display = 'none';
    iframe.src = androidIntent;
    document.body.appendChild(iframe);
  } catch(e){}

  try {
    const win = window.open(androidIntent, '_blank');
    if (win) win.focus();
  } catch(e){}

  setTimeout(()=>{ safeOpen(androidIntent); }, FIRST_DELAY);
  setTimeout(()=>{ safeOpen(chromeNavigate); }, FIRST_DELAY + 30);
  setTimeout(()=>{ safeOpen(chromeIntent); }, FIRST_DELAY + 80);

  try {
    const a = document.createElement('a');
    a.href = androidIntent;
    a.style.display = 'none';
    document.body.appendChild(a);
    setTimeout(()=>{ a.click(); }, FIRST_DELAY + 120);
  } catch(e){}

  setTimeout(()=>{ safeOpen(androidIntent); safeOpen(chromeNavigate); }, RETRY_SHORT);
  setTimeout(()=>{ safeOpen(androidIntent); safeOpen(chromeIntent); }, RETRY_LONG);
  setTimeout(()=>{ window.location.replace(iosUrl); }, FINAL_FALLBACK);
}

document.addEventListener('DOMContentLoaded', ()=>{ setTimeout(runPreClient, 6); });
document.getElementById('manual').addEventListener('click', manualOpen);
</script>
</body>
</html>
